
spark.sql("""select null communication_id,null communication_type,trim(mdm_attrib_type) mdm_attrib_type,mdm_attrib_value,trim(mdm_status_cd) mdm_status_cd,trim(mdm_party_id) mdm_party_id,mdm_attrib_value_2,mdm_ins_dt,mdm_last_mod_dt,mdm_eff_end_dt from all_all_r_gbl_mdm.lnd_cdw_party_n_prof where mdm_attrib_type in ('ALT','ALT_EMAIL','FAX','MOBILE','OFFICE','ORG_URL','FAX_NUM','PHONE_NUM') and MDM_PARTY_ID is not null and mdm_attrib_value is not null and mdm_attrib_value!='null' 
minus 
select communication_id, communication_type, type, value, status, trim(customer_id) customer_id, addr_id, mdm_ins_date, mdm_last_mod_date, mdm_eff_end_date from all_all_e_gbl_customer.idl_mdm_comm""").createOrReplaceTempView("idl_mdm_comm")


//below query using fetch insert and update records 

spark.sql("select distinct xref.* from ALL_ALL_R_GBL_MDM.lnd_cdw_party_n_prof xref left anti join idl_mdm_comm idl on trim(xref.mdm_party_id)=trim(idl.mdm_party_id) and  xref.mdm_attrib_type in ('ALT','ALT_EMAIL','FAX','MOBILE','OFFICE','ORG_URL','FAX_NUM','PHONE_NUM') and xref.MDM_PARTY_ID is not null and xref.mdm_attrib_value is not null and xref.mdm_attrib_value!='null' union all select distinct xref.* from ALL_ALL_R_GBL_MDM.lnd_cdw_party_n_prof xref  join idl_mdm_comm idl on trim(xref.mdm_party_id)=trim(idl.mdm_party_id) and  xref.mdm_attrib_type in ('ALT','ALT_EMAIL','FAX','MOBILE','OFFICE','ORG_URL','FAX_NUM','PHONE_NUM') ").createOrReplaceTempView("lnd_cdw_party_n_prof")



spark.sql("""select null communication_id,null communication_type,trim(mdm_attrib_type)  mdm_attrib_type,mdm_attrib_value,trim(mdm_status_cd) mdm_status_cd,trim(mdm_party_id) mdm_party_id,mdm_attrib_value_2,mdm_ins_dt,mdm_last_mod_dt,mdm_eff_end_dt from ALL_ALL_R_GBL_MDM.lnd_cdw_party_n_org where mdm_attrib_type in ('ALT','ALT_EMAIL','FAX','MOBILE','OFFICE','ORG_URL','FAX_NUM','PHONE_NUM') and MDM_PARTY_ID is not null and mdm_attrib_value is not null and mdm_attrib_value!='null'
union 
select null communication_id,null communication_type,trim(mdm_attrib_type) mdm_attrib_type,mdm_attrib_value,trim(mdm_status_cd) mdm_status_cd,trim(mdm_party_id) mdm_party_id,mdm_attrib_value_2,mdm_ins_dt,mdm_last_mod_dt,mdm_eff_end_dt from ALL_ALL_R_GBL_MDM.lnd_cdw_party_n_org where mdm_attrib_type in ('EMAIL') and MDM_PARTY_ID is not null and mdm_attrib_value is not null and mdm_attrib_value!='null'
minus 
select communication_id, communication_type, type, value, status, trim(customer_id) customer_id, addr_id, mdm_ins_date, mdm_last_mod_date, mdm_eff_end_date from all_all_e_gbl_customer.idl_mdm_comm""").createOrReplaceTempView("idl_mdm_comm1")


//below query using fetch insert and update records 

spark.sql("select distinct xref.* from ALL_ALL_R_GBL_MDM.lnd_cdw_party_n_org xref left anti join idl_mdm_comm1 idl on trim(xref.mdm_party_id)=trim(idl.mdm_party_id) and xref.mdm_attrib_type in ('ALT','ALT_EMAIL','FAX','MOBILE','OFFICE','ORG_URL','FAX_NUM','PHONE_NUM') and xref.MDM_PARTY_ID is not null and xref.mdm_attrib_value is not null and xref.mdm_attrib_value!='null' union all select distinct xref.* from ALL_ALL_R_GBL_MDM.lnd_cdw_party_n_org xref join idl_mdm_comm1 idl on trim(xref.mdm_party_id)=trim(idl.mdm_party_id) and xref.mdm_attrib_type in ('ALT','ALT_EMAIL','FAX','MOBILE','OFFICE','ORG_URL','FAX_NUM','PHONE_NUM')").createOrReplaceTempView("lnd_cdw_party_n_org")


spark.sql("""insert into ALL_ALL_R_GBL_MDM.stg_mdm_comm select null,null,trim(mdm_attrib_type) mdm_attrib_type,mdm_attrib_value,trim(mdm_status_cd) mdm_status_cd,null,trim(mdm_party_id) mdm_party_id ,mdm_attrib_value_2,mdm_ins_dt,mdm_last_mod_dt,mdm_eff_end_dt,current_timestamp,'9999' batch_id,'MDM',null,'Y' from ALL_ALL_R_GBL_MDM.lnd_cdw_party_n_prof where mdm_attrib_type in ('ALT','ALT_EMAIL','FAX','MOBILE','OFFICE','ORG_URL','FAX_NUM','PHONE_NUM') and MDM_PARTY_ID is not null and mdm_attrib_value is not null and mdm_attrib_value!='null'  union all select null,null,trim(mdm_attrib_type) mdm_attrib_type, mdm_attrib_value,trim(mdm_status_cd) mdm_status_cd,null,trim(mdm_party_id) mdm_party_id ,mdm_attrib_value_2,mdm_ins_dt,mdm_last_mod_dt,mdm_eff_end_dt,current_timestamp,'9999' batch_id,'MDM','BAD RECORD: NO MDM ID','E' from ALL_ALL_R_GBL_MDM.lnd_cdw_party_n_prof where mdm_attrib_type in ('ALT','ALT_EMAIL','FAX','MOBILE','OFFICE','ORG_URL','FAX_NUM','PHONE_NUM') and MDM_PARTY_ID is null and mdm_attrib_value is not null and mdm_attrib_value!='null'  union all select null,null,trim(mdm_attrib_type) mdm_attrib_type,mdm_attrib_value,trim(mdm_status_cd) mdm_status_cd,null,trim(mdm_party_id) mdm_party_id,mdm_attrib_value_2,mdm_ins_dt,mdm_last_mod_dt,mdm_eff_end_dt,current_timestamp,'9999' batch_id,'MDM','BAD RECORD: NO MDM ID','E' from ALL_ALL_R_GBL_MDM.lnd_cdw_party_n_prof where mdm_attrib_type in ('EMAIL') and MDM_PARTY_ID is null and mdm_attrib_value is not null and mdm_attrib_value!='null'   union all select null,null,trim(mdm_attrib_type) mdm_attrib_type ,mdm_attrib_value,trim(mdm_status_cd) mdm_status_cd,null,trim(mdm_party_id) mdm_party_id,mdm_attrib_value_2,mdm_ins_dt,mdm_last_mod_dt,mdm_eff_end_dt,current_timestamp,'9999' batch_id,'MDM',null,'Y' from ALL_ALL_R_GBL_MDM.lnd_cdw_party_n_prof where mdm_attrib_type in ('EMAIL') and MDM_PARTY_ID is not null and mdm_attrib_value is not null and mdm_attrib_value!='null'  union all select null,null,trim(mdm_attrib_type) mdm_attrib_type,mdm_attrib_value,trim(mdm_status_cd) mdm_status_cd,null,trim(mdm_party_id) mdm_party_id,mdm_attrib_value_2,mdm_ins_dt,mdm_last_mod_dt,mdm_eff_end_dt,current_timestamp,'9999' batch_id,'MDM',null,'Y' from ALL_ALL_R_GBL_MDM.lnd_cdw_party_n_org where mdm_attrib_type in ('ALT','ALT_EMAIL','FAX','MOBILE','OFFICE','ORG_URL','FAX_NUM','PHONE_NUM') and MDM_PARTY_ID is not null and mdm_attrib_value is not null and mdm_attrib_value!='null'  union all select null,null,trim(mdm_attrib_type) mdm_attrib_type,mdm_attrib_value,trim(mdm_status_cd) mdm_status_cd,null,trim(mdm_party_id) mdm_party_id,mdm_attrib_value_2,mdm_ins_dt,mdm_last_mod_dt,mdm_eff_end_dt,current_timestamp,'9999' batch_id,'MDM','BAD RECORD: NO MDM ID','E' from ALL_ALL_R_GBL_MDM.lnd_cdw_party_n_org where mdm_attrib_type in ('ALT','ALT_EMAIL','FAX','MOBILE','OFFICE','ORG_URL','FAX_NUM','PHONE_NUM') and MDM_PARTY_ID is null and mdm_attrib_value is not null and mdm_attrib_value!='null'  union all select null,null,trim(mdm_attrib_type) mdm_attrib_type,mdm_attrib_value,trim(mdm_status_cd) mdm_status_cd,null,trim(mdm_party_id) mdm_party_id,mdm_attrib_value_2,mdm_ins_dt,mdm_last_mod_dt,mdm_eff_end_dt,current_timestamp,'9999' batch_id,'MDM','BAD RECORD: NO MDM ID','E' from ALL_ALL_R_GBL_MDM.lnd_cdw_party_n_org where mdm_attrib_type in ('EMAIL') and MDM_PARTY_ID is null and mdm_attrib_value is not null and mdm_attrib_value!='null'  union all select null,null,trim(mdm_attrib_type) mdm_attrib_type,mdm_attrib_value,trim(mdm_status_cd) mdm_status_cd ,null,trim(mdm_party_id) mdm_party_id,mdm_attrib_value_2,mdm_ins_dt,mdm_last_mod_dt,mdm_eff_end_dt,current_timestamp,'9999' batch_id,'MDM',null,'Y' from ALL_ALL_R_GBL_MDM.lnd_cdw_party_n_org where mdm_attrib_type in ('EMAIL') and MDM_PARTY_ID is not null and mdm_attrib_value is not null and mdm_attrib_value!='null' """)
